<main class="dashboard-content">
    <!-- HEADER -->
    <header class="dashboard-header">
        <div class="left">
            <h1>Docentes</h1>
        </div>
        <div class="right">
            <span>Rol: Talento Humano</span>
            <div class="user-section" (click)="toggleUserMenu()" (blur)="cerrarMenu()" tabindex="0">
                <img src="img/campana.png" alt="Notificaciones" class="icon" />
                <span>
                    <img src="img/usuario.png" alt="Usuario" class="user-icon" />
                    Usuario ▼
                </span>
                <div class="user-dropdown" *ngIf="userMenuOpen">
                    <ul>
                        <li (click)="verPerfil()">Mi Perfil</li>
                        <li (click)="cerrarSesion()">Cerrar Sesión</li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <hr class="content-divider" />

    <!-- FILTROS -->
    <!-- FILTROS -->
    <section class="filters-card">
        <div class="filter-group">
            <label for="tipoContrato">Tipo de Contrato</label>
            <select id="tipoContrato" [(ngModel)]="filtroContrato" (change)="filtrarDocentes()">
                <option value="Todos">Todos</option>
                <option *ngFor="let contrato of contratos" [value]="contrato.nombre">
                    {{ contrato.nombre }}
                </option>
            </select>
        </div>

        <div class="filter-group">
            <label for="nivelIngles">Nivel de Inglés</label>
            <select id="nivelIngles" [(ngModel)]="filtroNivelIngles" (change)="filtrarDocentes()">
                <option value="Todos">Todos</option>
                <option *ngFor="let nivel of nivelesIngles" [value]="nivel.nombre">
                    {{ nivel.nombre }}
                </option>
            </select>
        </div>

        <div class="filter-group">
            <label for="experiencia">Experiencia Mínima</label>
            <input id="experiencia" type="number" [(ngModel)]="filtroExperiencia" (input)="filtrarDocentes()"
                placeholder="0" />
        </div>

        <div class="filter-group acciones-filtros">
            <label style="visibility: hidden;">Acciones</label>
            <div class="botones-filtro">
                <button class="btn primary" (click)="resetearFiltros()">Limpiar</button>
                <label class="btn secondary cargar-excel-label">
                    Cargar Excel
                    <input type="file" hidden (change)="cargarDesdeExcel($event)" accept=".csv" />
                </label>
            </div>
        </div>
    </section>

    <!-- LISTA DE DOCENTES -->
    <section class="docentes-section">
        <div class="docentes-header">
            <h2>Lista de Docentes</h2>
            <div class="actions">
                <input type="text" [(ngModel)]="textoBusqueda" (ngModelChange)="filtrarDocentes()"
                    placeholder="Buscar por nombre..." />
                <button class="btn primary" (click)="abrirModal()">+ Agregar</button>
            </div>
        </div>

        <div class="docentes-table">
            <table>
                <thead>
                    <tr>
                        <th>Nombre Completo</th>
                        <th>Correo</th>
                        <th>Teléfono</th>
                        <th>Tipo de Contrato</th>
                        <th>Experiencia</th>
                        <th>Nivel de Inglés</th>
                        <th>Horas</th>
                        <th>Especialización</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let docente of docentesFiltrados; let i = index">
                        <td>
                            {{ docente.persona?.primer_nombre }} {{ docente.persona?.segundo_nombre }} {{
                            docente.persona?.primer_apellido }} {{ docente.persona?.segundo_apellido }}
                        </td>
                        <td *ngIf="editIndex !== i">{{ docente.persona?.correo }}</td>
                        <td *ngIf="editIndex === i">
                            <input [(ngModel)]="docente.editValues.correo" />
                        </td>
                        <td *ngIf="editIndex !== i">{{ docente.persona?.telefono }}</td>
                        <td *ngIf="editIndex === i">
                            <input [(ngModel)]="docente.editValues.telefono" />
                        </td>
                        <td *ngIf="editIndex !== i">{{ docente.tipo_contrato?.nombre }}</td>
                        <td *ngIf="editIndex === i">
                            <select [(ngModel)]="docente.editValues.tipo_contrato_id">
                                <option *ngFor="let contrato of contratos" [value]="contrato.id">{{ contrato.nombre }}
                                </option>
                            </select>
                        </td>
                        <td *ngIf="editIndex !== i">{{ docente.experiencia_anios }}</td>
                        <td *ngIf="editIndex === i">
                            <input type="number" [(ngModel)]="docente.editValues.experiencia_anios" />
                        </td>
                        <td *ngIf="editIndex !== i">{{ docente.nivel_ingles?.nombre }}</td>
                        <td *ngIf="editIndex === i">
                            <select [(ngModel)]="docente.editValues.nivel_ingles_id">
                                <option *ngFor="let nivel of nivelesIngles" [value]="nivel.id">{{ nivel.nombre }}
                                </option>
                            </select>
                        </td>
                        <td *ngIf="editIndex !== i">{{ docente.horas_disponibles }}</td>
                        <td *ngIf="editIndex === i">
                            <input type="number" [(ngModel)]="docente.editValues.horas_disponibles" />
                        </td>
                        <td *ngIf="editIndex !== i">
                            <span *ngFor="let e of docente.especializaciones">{{ e.especializacion?.nombre
                                }}<br /></span>
                        </td>
                        <td *ngIf="editIndex === i">
                            <div style="display: flex; flex-direction: column;">
                                <label *ngFor="let espec of especializaciones"
                                    style="display: flex; align-items: center;">
                                    <input type="checkbox" [value]="espec.id"
                                        [checked]="docente.editValues.especializaciones?.includes(espec.id)"
                                        (change)="toggleEspecializacionEditar(docente, espec.id, $event)" />
                                    {{ espec.nombre }}
                                </label>
                            </div>
                        </td>
                        <td>
                            <ng-container *ngIf="editIndex !== i">
                                <button (click)="editarFila(i)">
                                    <img src="img/edicion.png" alt="Editar" width="20" />
                                </button>
                                <button (click)="eliminarFila(i)">
                                    <img src="img/eliminar.png" alt="Eliminar" width="20" />
                                </button>
                            </ng-container>
                            <ng-container *ngIf="editIndex === i">
                                <button (click)="guardarFila(i)">
                                    <img src="img/guardar.png" alt="Guardar" width="20" />
                                </button>
                                <button (click)="cancelarEdicion()">
                                    <img src="img/cancelar.png" alt="Cancelar" width="20" />
                                </button>
                            </ng-container>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- MODAL AGREGAR DOCENTE -->
    <div class="modal-backdrop" *ngIf="mostrarModal">
        <div class="modal">
            <h3>Agregar Docente</h3>
            <form (ngSubmit)="agregarDocente()" #formDocente="ngForm">
                <!-- DATOS DEL DOCENTE -->
                <div class="datos-docente-section">
                    <h4 class="section-title">Datos del Docente</h4>
                    
                    <!-- Información Personal -->
                    <div class="form-section">
                        <h5 class="subsection-title">Información Personal</h5>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="primer_nombre">Primer Nombre *</label>
                                <input 
                                    id="primer_nombre"
                                    type="text" 
                                    [(ngModel)]="nuevoDocente.primer_nombre" 
                                    name="primer_nombre" 
                                    required 
                                    placeholder="Ingrese el primer nombre" />
                            </div>
                            
                            <div class="form-group">
                                <label for="segundo_nombre">Segundo Nombre</label>
                                <input 
                                    id="segundo_nombre"
                                    type="text" 
                                    [(ngModel)]="nuevoDocente.segundo_nombre" 
                                    name="segundo_nombre" 
                                    placeholder="Ingrese el segundo nombre" />
                            </div>
                            
                            <div class="form-group">
                                <label for="primer_apellido">Primer Apellido *</label>
                                <input 
                                    id="primer_apellido"
                                    type="text" 
                                    [(ngModel)]="nuevoDocente.primer_apellido" 
                                    name="primer_apellido" 
                                    required 
                                    placeholder="Ingrese el primer apellido" />
                            </div>
                            
                            <div class="form-group">
                                <label for="segundo_apellido">Segundo Apellido</label>
                                <input 
                                    id="segundo_apellido"
                                    type="text" 
                                    [(ngModel)]="nuevoDocente.segundo_apellido" 
                                    name="segundo_apellido" 
                                    placeholder="Ingrese el segundo apellido" />
                            </div>
                            
                            <div class="form-group">
                                <label for="cedula">Cédula *</label>
                                <input 
                                    id="cedula"
                                    type="text" 
                                    [(ngModel)]="nuevoDocente.cedula" 
                                    name="cedula" 
                                    required 
                                    placeholder="Ingrese la cédula" />
                            </div>
                            
                            <div class="form-group">
                                <label for="correo">Correo Electrónico *</label>
                                <input 
                                    id="correo"
                                    type="email" 
                                    [(ngModel)]="nuevoDocente.correo" 
                                    name="correo" 
                                    required 
                                    placeholder="ejemplo@email.com" />
                            </div>
                            
                            <div class="form-group">
                                <label for="telefono">Teléfono *</label>
                                <input 
                                    id="telefono"
                                    type="tel" 
                                    [(ngModel)]="nuevoDocente.telefono" 
                                    name="telefono" 
                                    required 
                                    placeholder="0991234567" />
                            </div>
                        </div>
                    </div>
                    
                    <!-- Información Profesional -->
                    <div class="form-section">
                        <h5 class="subsection-title">Información Profesional</h5>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tipo_contrato">Tipo de Contrato *</label>
                                <select 
                                    id="tipo_contrato"
                                    [(ngModel)]="nuevoDocente.tipo_contrato_id" 
                                    name="tipo_contrato_id" 
                                    required>
                                    <option value="" disabled selected>Seleccione un tipo de contrato</option>
                                    <option *ngFor="let contrato of contratos" [value]="contrato.id">
                                        {{ contrato.nombre }}
                                    </option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="experiencia_anios">Experiencia (años) *</label>
                                <input 
                                    id="experiencia_anios"
                                    type="number" 
                                    [(ngModel)]="nuevoDocente.experiencia_anios" 
                                    name="experiencia_anios" 
                                    required 
                                    min="0"
                                    placeholder="0" />
                            </div>
                            
                            <div class="form-group">
                                <label for="nivel_ingles">Nivel de Inglés *</label>
                                <select 
                                    id="nivel_ingles"
                                    [(ngModel)]="nuevoDocente.nivel_ingles_id" 
                                    name="nivel_ingles_id" 
                                    required>
                                    <option value="" disabled selected>Seleccione el nivel de inglés</option>
                                    <option *ngFor="let nivel of nivelesIngles" [value]="nivel.id">
                                        {{ nivel.nombre }}
                                    </option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="horas_disponibles">Horas Disponibles *</label>
                                <input 
                                    id="horas_disponibles"
                                    type="number" 
                                    [(ngModel)]="nuevoDocente.horas_disponibles" 
                                    name="horas_disponibles" 
                                    required 
                                    min="0"
                                    placeholder="0" />
                            </div>
                        </div>
                    </div>
                    
                    <!-- Especializaciones -->
                    <div class="form-section">
                        <h5 class="subsection-title">Especializaciones</h5>
                        <div class="especializaciones-container">
                            <div class="especializaciones-grid">
                                <div class="especializacion-item" *ngFor="let espec of especializaciones">
                                    <label class="checkbox-container">
                                        <input 
                                            type="checkbox" 
                                            [value]="espec.id"
                                            (change)="toggleEspecializacion(espec.id, $event)" />
                                        <span class="checkmark"></span>
                                        <span class="especializacion-label">{{ espec.nombre }}</span>
                                    </label>
                                </div>
                            </div>
                            <div class="especializaciones-summary" *ngIf="nuevoDocente.especializaciones.length > 0">
                                <p class="summary-text">
                                    <strong>{{ nuevoDocente.especializaciones.length }}</strong> especialización(es) seleccionada(s)
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- HORARIOS -->
                <div class="horarios-section">
                    <h4 class="horarios-title">Disponibilidad Horaria</h4>
                    <div class="horarios-container">
                        <table class="horarios-tabla">
                            <thead>
                                <tr>
                                    <th class="checkbox-header">
                                        <input type="checkbox" 
                                               (change)="toggleAllHorarios($event)"
                                               [checked]="areAllHorariosSelected()"
                                               [indeterminate]="areSomeHorariosSelected()" />
                                    </th>
                                    <th>Día</th>
                                    <th>Hora Inicio</th>
                                    <th>Hora Fin</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let horario of horariosDisponibles; let i = index" 
                                    [class.selected]="isHorarioSelected(horario.id)"
                                    [class.even]="i % 2 === 0">
                                    <td class="checkbox-cell">
                                        <input type="checkbox" 
                                               [value]="horario.id"
                                               [checked]="isHorarioSelected(horario.id)"
                                               (change)="toggleHorario(horario.id, $event)" />
                                    </td>
                                    <td class="dia-cell">{{ horario.dia }}</td>
                                    <td class="hora-cell">{{ formatTime(horario.hora_inicio) }}</td>
                                    <td class="hora-cell">{{ formatTime(horario.hora_fin) }}</td>
                                    <td class="estado-cell">
                                        <span class="estado-badge" 
                                              [class.selected]="isHorarioSelected(horario.id)">
                                            {{ isHorarioSelected(horario.id) ? 'Seleccionado' : 'Disponible' }}
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="horarios-summary" *ngIf="getSelectedHorariosCount() > 0">
                            <p class="summary-text">
                                <strong>{{ getSelectedHorariosCount() }}</strong> horario(s) seleccionado(s)
                            </p>
                        </div>
                    </div>
                </div>

                <!-- BOTONES -->
                <div class="modal-actions" style="margin-top: 1rem; text-align: right;">
                    <button type="button" class="btn secondary" (click)="cerrarModal()">Cancelar</button>
                    <button type="submit" class="btn primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</main>